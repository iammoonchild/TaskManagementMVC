@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    // Get the current controller name
    string currentController = ViewContext.RouteData.Values["controller"].ToString();
    string userName = ViewBag.UserName;
    var username = HttpContextAccessor.HttpContext.Session.GetString("Username");
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewBag.Title</title>
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
   <link rel="stylesheet" href="~/TaskManagementMVC.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
   <style>
       header a{
          text-decoration: none;
           color: black !important;
       }
   </style>

    <style>
        .navbar-nav .nav-item.active .nav-link {
            background-color: rgba(255, 255, 255, 0.2); /* Background color */
            border-radius: 5px; /* Border radius */
            transition: background-color 0.3s ease; /* Smooth transition */
        }

            .navbar-nav .nav-item.active .nav-link:hover {
                background-color: rgba(255, 255, 255, 0.3); /* Hover background color */
            }

            .navbar-nav .nav-item.active .nav-link .bi {
                color: #fff; /* Icon color */
            }

            .navbar-nav .nav-item.active .nav-link span {
                color: #fff; /* Text color */
            }
    </style>
</head>
<body>
    <div id="overlay" class="overlay">
        <div class="loader"></div>
    </div>

    <header class="bg-light">
        <div class="container-fluid pt-3">
            <div class="row align-items-center">
                <div class="col-6">
                    <a class="navbar-brand" href="#">
                        <div class="d-flex align-items-center">
                            <img src="~/images/logo-ptm.png" alt="Logo" width="80">
                            <span class="ms-2 fs-3 d-none d-md-inline-block">Project Task Management</span>
                            <span class="ms-2 fs-3 d-md-none">PTM</span>
                        </div>
                    </a>
                </div>
                <div class="col-6 text-end">
                    <div class="right-wrapper d-flex align-items-center justify-content-end">
                        <div class="d-lg-inline-block d-none">
                            <a class="nav-link d-lg-flex flex-column align-items-center" href="#">
                                <i class="bi bi-bell" style="font-size: 1.5rem;"></i>
                                <span>Notifications</span>
                            </a>
                        </div>
                        <div class="d-lg-inline-block d-none ms-3">
                            <a class="nav-link d-lg-flex flex-column align-items-center" href="#">
                                <img src="~/images/memberavatar.png" alt="Profile" width="40" class="rounded-circle">
                                <span>@username</span>
                            </a>
                        </div>
                        <div class="d-lg-inline-block d-none ms-3">
                            <a class="nav-link d-lg-flex flex-column align-items-center"
                            asp-action="Logout" asp-controller="User">
                                <i class="bi bi-box-arrow-right" style="font-size: 1.5rem;"></i>
                                <span>Logout</span>
                            </a>
                        </div>
                        <div class="d-lg-none">
                            <button class="navbar-toggler pe-3" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                                    aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"><i class="bi bi-list" style="font-size: 1.5rem;"></i></span>
                            </button>
                        </div>
                    </div>
                    <!-- Right side notification icon and profile display -->
                </div>
            </div>
        </div>
    </header>

    <!-- Navbar -->
    @* <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid ms-3">
            <!-- Navbar toggler -->
            <!-- <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button> -->
            <!-- Navbar items -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="@Url.Action("Dashboard", currentController)">
                            <i class="bi bi-card-checklist me-2 d-lg-none" style="font-size: 1.5rem;"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="@Url.Action("MyTeams", currentController)">
                            <i class="bi bi-people me-2 d-lg-none" style="font-size: 1.5rem;"></i>
                            <span>My Teams</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="@Url.Action("Calendar", currentController)">
                            <i class="bi bi-graph-up me-2 d-lg-none" style="font-size: 1.5rem;"></i>
                            <span>My Calender</span>
                        </a>
                    </li>
                    <!-- Add more navbar items as needed -->
                    <!-- Notification icon and Profile Display but display size not more than lg -->
                    <li class="nav-item d-lg-none">
                        <a class="nav-link d-lg-flex align-items-center" href="#">
                            <i class="bi bi-bell me-2" style="font-size: 1.5rem;"></i> <span>Notifications</span>
                        </a>
                    </li>
                    <li class="nav-item d-lg-none">
                        <a class="nav-link d-lg-flex align-items-center" href="#">
                            <img src="~/images/memberavatar.png" alt="Profile" width="30" class="rounded-circle me-2"><span>
                                User
                                Name
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav> *@

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
           
            <!-- Toggler button for mobile view -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <!-- Navbar items -->
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    @if (currentController != "Member")
                    {
                        <li class="nav-item">
                            <a class="nav-link" href="@Url.Action("Dashboard", currentController)" onclick="setActiveNavItem(3)">
                                <i class="bi bi-house-door me-2"></i>
                                <span class="d-lg-inline-block text-white">Dashboard</span>
                            </a>
                        </li>
                    }
                    @if (currentController == "TeamLead" || currentController == "Member")
                    {
                        <li class="nav-item">
                            <a class="nav-link" href="@Url.Action("Kanban", currentController)" onclick="setActiveNavItem(4)">
                                <i class="bi bi-people me-2"></i>
                                <span class="d-lg-inline-block text-white">Kanban</span>
                            </a>
                        </li>
                    }
                    else
                    {
                        <li class="nav-item">
                            <a class="nav-link" href="@Url.Action("MyTeams", currentController)" onclick="setActiveNavItem(4)">
                                <i class="bi bi-people me-2"></i>
                                <span class="d-lg-inline-block text-white">My Teams</span>
                            </a>
                        </li>
                    }
                    @if (currentController != "Member")
                    {
                        <li class="nav-item">
                            <a class="nav-link" href="@Url.Action("Calendar", currentController)" onclick="setActiveNavItem(5)">
                                <i class="bi bi-calendar3 me-2"></i>
                                <span class="d-lg-inline-block text-white">My Calendar</span>
                            </a>
                        </li>
                    }
                    <!-- Add more navbar items as needed -->
                </ul>
                <!-- Notification and profile icons for mobile view -->
                <ul class="navbar-nav ms-auto d-lg-none">
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <i class="bi bi-bell me-2"></i>
                            <span>Notifications</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">
                            <img src="~/images/memberavatar.png" alt="Profile" width="30" class="rounded-circle me-2">
                            <span>User Name</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div class="container mt-2" id="backButtonDiv">
        <div class="row my-3 justify-content-end">
            <button class="btn btn-primary col-1"  onclick="window.history.back()"><i class="bi bi-arrow-left me-3"></i> Back</button>
        </div>
    </div>
    <div class="container-fluid">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer class="border-top footer text-muted position-relative">
        <div class="container">
            &copy; 2024 - TaskManagementMVC - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
        </div>
    </footer>

    <!-- Bootstrap JS bundle (required) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)

    <script>
        // Function to handle navigation item clicks
        function navigateToPage(url) {
            window.location.href = url;
        }
    </script>
    <script>
        var checkDashboard = localStorage.getItem('Dashboard');
        if (checkDashboard === 'Dashboard') {
            $("#backButtonDiv").addClass('d-none');
        }
        else {
            $("#backButtonDiv").removeClass('d-none');
        }
        var roleData = localStorage.getItem('RoleMember');
        if (roleData === 'Member') {
            var clickedNavLink = document.querySelectorAll('.nav-link')[5];
            clickedNavLink.className += ' d-none';
        }
        // Function to set the active item in the navbar
        function setActiveNavItem(index) {
            // Remove active class from all nav links
            
            console.log(index + " this is serActiveNavItem")
            localStorage.setItem('activeNavItemIndex', index);
        }

        function setActiveNavItemOnLoad() {
            var activeNavItemIndex = localStorage.getItem('activeNavItemIndex');
            var index = parseInt(activeNavItemIndex);
            console.log(parseInt(activeNavItemIndex) + " this is serActiveNavItemOnLoad")
            if (activeNavItemIndex !== null) {
                setActiveNavItem(parseInt(activeNavItemIndex));
            }
            else {
                setActiveNavItem(3);
            }

            var navLinks = document.querySelectorAll('.nav-link');
            for (var i = 0; i < navLinks.length; i++) {
                navLinks[i].className = navLinks[i].className.replace(/\bactive\b/g, '');
            }

            // Add active class to the clicked nav link based on the index
            var clickedNavLink = document.querySelectorAll('.nav-link')[index];
            clickedNavLink.className += ' active';
        }

        // Call the setActiveNavItemOnLoad function when the page loads
        window.onload = setActiveNavItemOnLoad;

        window.addEventListener('beforeunload', function () {
            localStorage.removeItem('RoleMember');
            localStorage.removeItem('Dashboard');
        });
    </script>

</body>
</html>
